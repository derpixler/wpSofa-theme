{"version":3,"sources":["webpack:///./template-parts/player/assets/js/player.js"],"names":["localstorageHandle","require","hash","mediaPlayer","this","options","storage_key","currentPos","selectors","player","controls","startStop","progressBar","duration","players","cacheTime","collectPlayers","length","addEvents","self","selector","document","querySelectorAll","forEach","call","playerControls","playerSources","audio","querySelector","sources","source","type","getAttribute","currentTime","push","node","map","event","addEventListener","e","playStop","currentTarget","playStopElem","btn","classes","classList","contains","remove","add","play","pause","currTimeElem","get","innerText","formatSecondsAsTime","playerTimeUpdater","percent","Math","floor","style","width","dataset","progress","secs","hr","min","sec","module","exports"],"mappings":"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","file":"player-js.chunk.js","sourcesContent":["const localstorageHandle = require( '@web-dev-media/localstorage' );\nconst hash = require( 'object-hash' );\n\nclass mediaPlayer {\n\tconstructor() {\n\t\tthis.options = {\n\t\t\tstorage_key: 'wpsofa-player-storage',\n\t\t\tcurrentPos : 0,\n\t\t\tselectors  : {\n\t\t\t\tplayer  : '.player',\n\t\t\t\tcontrols: {\n\t\t\t\t\tstartStop  : '.media-action',\n\t\t\t\t\tprogressBar: '.progress .status',\n\t\t\t\t\tduration: '.status'\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tthis.players = [];\n\n\t\tlocalstorageHandle.options.cacheTime = -1;\n\n\t\tthis.collectPlayers();\n\n\t\tif(this.players.length > 0) {\n\t\t\tthis.addEvents();\n\t\t}\n\t}\n\n\tcollectPlayers() {\n\t\tlet self = this;\n\n\t\tif ( self.options.selectors ) {\n\t\t\tlet selector = self.options.selectors.player;\n\n\t\t\tif ( selector ) {\n\t\t\t\tlet players = document.querySelectorAll( selector );\n\n\t\t\t\t[].forEach.call( players, function( player ) {\n\t\t\t\t\tlet playerControls = {};\n\t\t\t\t\tlet playerSources = {};\n\n\t\t\t\t\tlet audio = player.querySelector( 'audio' );\n\t\t\t\t\tlet sources = player.querySelectorAll( 'source' );\n\n\t\t\t\t\tif ( sources && audio ) {\n\t\t\t\t\t\t[].forEach.call( sources, function( source ) {\n\t\t\t\t\t\t\tlet type = source.getAttribute( 'type' );\n\t\t\t\t\t\t\tplayerSources[ type ] = source.getAttribute( 'src' );\n\t\t\t\t\t\t} );\n\n\t\t\t\t\t\tfor ( selector in self.options.selectors.controls ) {\n\t\t\t\t\t\t\tplayerControls[ selector ] = player.querySelector( self.options.selectors.controls[ selector ] );\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tplayerControls.currentTime = player.querySelector( '.current-time' );\n\n\t\t\t\t\t\tself.players.push( {\n\t\t\t\t\t\t\tnode    : player,\n\t\t\t\t\t\t\taudio   : audio,\n\t\t\t\t\t\t\tcontrols: playerControls,\n\t\t\t\t\t\t\tsources : playerSources,\n\t\t\t\t\t\t\thash    : hash( playerSources )\n\t\t\t\t\t\t} );\n\t\t\t\t\t}\n\n\t\t\t\t} );\n\t\t\t}\n\t\t}\n\t}\n\n\taddEvents() {\n\t\tif(this.players) {\n\t\t\tthis.players.forEach(player => {\n\t\t\t\t[ 'play', 'pause', 'timeupdate', 'loadeddata'].map( event => {\n\t\t\t\t\tplayer.audio.addEventListener( event, (e) => this[event](player) );\n\t\t\t\t});\n\n\t\t\t\tplayer.controls.startStop.addEventListener('click', (e) => this.playStop(e.currentTarget, player));\n\n\t\t\t});\n\t\t}\n\t}\n\n\tplayStop(playStopElem, player){\n\t\tlet btn = playStopElem.querySelector('div');\n\t\tconst classes = {\n\t\t\tplay: 'play',\n\t\t\tpause: 'pause'\n\t\t};\n\n\t\tif(btn.classList.contains(classes.play)){\n\t\t\tbtn.classList.remove(classes.play);\n\t\t\tbtn.classList.add(classes.pause);\n\n\t\t\tplayStopElem.classList.remove(classes.play);\n\t\t\tplayStopElem.classList.add(classes.pause);\n\n\t\t\tplayer.audio.play();\n\t\t}else{\n\t\t\tbtn.classList.remove(classes.pause);\n\t\t\tbtn.classList.add(classes.play);\n\n\t\t\tplayStopElem.classList.remove(classes.pause);\n\t\t\tplayStopElem.classList.add(classes.play);\n\n\t\t\tplayer.audio.pause();\n\t\t}\n\t}\n\n\tplayerTimeUpdater(player){\n\t\tlet currTimeElem = player.controls.currentTime;\n\t\tlet currentTime = player.audio.currentTime ? player.audio.currentTime : localstorageHandle.get(player.hash + '_currentTime');\n\n\t\tif(player.audio.currentTime) {\n\t\t\tcurrTimeElem.innerText = this.formatSecondsAsTime( currentTime );\n\t\t}\n\t}\n\n\tplay(player){\n\t\tthis.playerTimeUpdater(player);\n\t}\n\n\tpause(player){\n\t\tthis.playerTimeUpdater(player);\n\t}\n\n\ttimeupdate(player){\n\t\tthis.playerTimeUpdater(player);\n\n\t\tif(player.audio.currentTime) {\n\t\t\tlet currTimeElem = player.controls.currentTime;\n\t\t\tlet percent = Math.floor( ( 100 / player.audio.duration) * player.audio.currentTime );\n\n\t\t\tplayer.controls.progressBar.style.width = percent + '%';\n\n\t\t\tif (percent > 95) {\n\t\t\t\tcurrTimeElem.dataset.progress = \"90\";\n\t\t\t} else if (percent > 80) {\n\t\t\t\tcurrTimeElem.dataset.progress = \"75\";\n\t\t\t} else if (percent > 50) {\n\t\t\t\tcurrTimeElem.dataset.progress = \"50\";\n\t\t\t} else if (percent > 25) {\n\t\t\t\tcurrTimeElem.dataset.progress = \"25\";\n\t\t\t} else {\n\t\t\t\tcurrTimeElem.dataset.progress = \"0\";\n\t\t\t}\n\n\t\t}\n\t}\n\n\tloadeddata(player){\n\t\t//console.log(player);\n\t}\n\n\tformatSecondsAsTime(secs) {\n\t\tvar hr  = Math.floor(secs / 3600);\n\t\tvar min = Math.floor((secs - (hr * 3600))/60);\n\t\tvar sec = Math.floor(secs - (hr * 3600) -  (min * 60));\n\n\t\tif (min < 10){\n\t\t\tmin = \"0\" + min;\n\t\t}\n\t\tif (sec < 10){\n\t\t\tsec  = \"0\" + sec;\n\t\t}\n\t\tif (hr < 10){\n\t\t\thr  = \"0\" + hr;\n\t\t}\n\n\t\treturn hr + ':' + min + ':' + sec;\n\t}\n\n}\n\nexports = module.exports = mediaPlayer;"],"sourceRoot":""}